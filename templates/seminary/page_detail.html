{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page.title }} - Holy Spirit Major Seminary{% endblock %}

{% block meta_description %}{{ page.meta_description|default:page.content|striptags|truncatewords:20 }}{% endblock %}

{% block extra_css %}

<!-- Rich text content styling - scoped to content area only -->
<style>
/* Rich text content styling - SCOPED to prevent header/footer interference */
.page-content-area .rich-content {
    font-family: 'Inter', sans-serif;
    line-height: 1.8;
    color: #374151;
}

.page-content-area .rich-content h1,
.page-content-area .rich-content h2,
.page-content-area .rich-content h3,
.page-content-area .rich-content h4,
.page-content-area .rich-content h5,
.page-content-area .rich-content h6 {
    font-family: 'Playfair Display', serif;
    color: #1f2937;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.page-content-area .rich-content h1 {
    font-size: 2.5rem;
    border-bottom: 3px solid #667eea;
    padding-bottom: 0.5rem;
}

.page-content-area .rich-content h2 {
    font-size: 2rem;
    color: #4f46e5;
    border-left: 4px solid #667eea;
    padding-left: 1rem;
}

.page-content-area .rich-content h3 {
    font-size: 1.5rem;
    color: #6366f1;
}

.page-content-area .rich-content p {
    margin-bottom: 1.5rem;
    text-align: justify;
    font-size: 1.1rem;
}

.page-content-area .rich-content ul,
.page-content-area .rich-content ol {
    margin: 1.5rem 0;
    padding-left: 2rem;
}

.page-content-area .rich-content li {
    margin-bottom: 0.5rem;
}

.page-content-area .rich-content blockquote {
    border-left: 4px solid #667eea;
    padding-left: 2rem;
    margin: 2rem 0;
    font-style: italic;
    font-size: 1.25rem;
    color: #4b5563;
    background-color: #f8fafc;
    padding: 1.5rem 2rem;
    border-radius: 0.5rem;
}

.page-content-area .rich-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin: 2rem 0;
}

.page-content-area .rich-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    overflow: hidden;
}

.page-content-area .rich-content th,
.page-content-area .rich-content td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
}

.page-content-area .rich-content th {
    background-color: #667eea;
    color: white;
    font-weight: 600;
}

.page-content-area .rich-content strong {
    font-weight: 700;
    color: #1f2937;
}

.page-content-area .rich-content em {
    font-style: italic;
    color: #4b5563;
}

/* Ensure page hero doesn't interfere with header */
.page-hero {
    margin-top: 0 !important;
}

/* Scope all page-specific styles to prevent header/footer interference */
.page-content-wrapper {
    isolation: isolate;
}

.page-content-wrapper * {
    /* This ensures styles don't leak to header/footer */
}
</style>
{% endblock %}

{% block content %}
<div class="page-content-wrapper">
    {% if page.slug == 'rector-welcome' %}
    <!-- Rector's Welcome Special Layout -->
    <section class="bg-gray-100 py-20 page-hero">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-5xl font-bold font-serif mb-4 text-gray-800">{{ page.title }}</h1>
                <nav class="text-lg text-gray-600">
                    <a href="{% url 'home' %}" class="hover:text-blue-600 transition-colors">Home</a>
                    <span class="mx-3">/</span>
                    <a href="{% url 'about_seminary' %}" class="hover:text-blue-600 transition-colors">Our Seminary</a>
                    <span class="mx-3">/</span>
                    <span>{{ page.title }}</span>
                </nav>
            </div>
        </div>
    </section>

    <section class="py-16 bg-white page-content-area">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <div class="flex flex-col md:flex-row gap-8 md:gap-12">
                    <!-- Rector's Image -->
                    <div class="md:w-1/3 text-center">
                        {% if rector.photo %}
                        <img src="{{ rector.photo.url }}" alt="{{ rector.name }}" 
                             class="rounded-lg shadow-lg w-full h-auto object-cover">
                        {% else %}
                        <div class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center">
                            <i class="fas fa-user text-6xl text-gray-400"></i>
                        </div>
                        {% endif %}
                        <h3 class="text-2xl font-bold mt-6 mb-2 text-gray-800">{{ rector.name }}</h3>
                        <p class="text-gray-600">{{ rector.title }}</p>
                    </div>
                    
                    <!-- Welcome Message with Rich Content -->
                    <div class="md:w-2/3">
                        <div class="rich-content">
                            {{ page.content|safe }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {% else %}
    <!-- Standard Page Layout -->
    <section class="bg-gradient-primary text-white py-20 page-hero">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-5xl font-bold font-serif mb-4 animate-fade-in-up">{{ page.title }}</h1>
                {% if breadcrumbs %}
                <nav class="text-lg opacity-90 animate-fade-in-up" style="animation-delay: 0.2s;">
                    {% for breadcrumb_title, breadcrumb_url in breadcrumbs %}
                        {% if breadcrumb_url %}
                            <a href="{% url breadcrumb_url %}" class="hover:text-blue-200 transition-colors">{{ breadcrumb_title }}</a>
                        {% else %}
                            <span>{{ breadcrumb_title }}</span>
                        {% endif %}
                        {% if not forloop.last %}<span class="mx-3">/</span>{% endif %}
                    {% endfor %}
                </nav>
                {% endif %}
            </div>
        </div>
    </section>

    <section class="py-16 bg-white page-content-area">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <!-- Featured Image -->
                {% if page.featured_image %}
                <div class="mb-12 animate-fade-in-up">
                    <img src="{{ page.featured_image.url }}" 
                         alt="{{ page.title }}" 
                         class="w-full h-64 md:h-96 object-cover rounded-lg shadow-lg">
                </div>
                {% endif %}
                
                <!-- Page Excerpt -->
                {% if page.excerpt %}
                <div class="mb-8 animate-fade-in-up">
                    <div class="text-xl text-gray-600 font-medium leading-relaxed bg-gray-50 p-6 rounded-lg border-l-4 border-blue-500">
                        {{ page.excerpt|safe }}
                    </div>
                </div>
                {% endif %}
                
                <!-- Page Content with Rich Text Support -->
                <div class="rich-content animate-fade-in-up" style="animation-delay: 0.2s;">
                    {{ page.content|safe }}
                </div>
                
                <!-- Page Meta Information -->
                <div class="mt-12 pt-8 border-t border-gray-200 animate-fade-in-up" style="animation-delay: 0.4s;">
                    <div class="flex flex-wrap items-center justify-between text-sm text-gray-500">
                        <div class="flex items-center space-x-4">
                            {% if page.author %}
                            <span>
                                <i class="fas fa-user mr-1"></i>
                                {{ page.author.get_full_name|default:page.author.username }}
                            </span>
                            {% endif %}
                            <span>
                                <i class="fas fa-calendar mr-1"></i>
                                Last updated: {{ page.updated_at|date:"M d, Y" }}
                            </span>
                        </div>
                        <div class="flex items-center space-x-2 mt-4 md:mt-0">
                            <span class="text-gray-400">Share:</span>
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
                               target="_blank"
                               class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors">
                                <i class="fab fa-facebook-f text-xs"></i>
                            </a>
                            <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ page.title }}" 
                               target="_blank"
                               class="w-8 h-8 bg-blue-400 text-white rounded-full flex items-center justify-center hover:bg-blue-500 transition-colors">
                                <i class="fab fa-twitter text-xs"></i>
                            </a>
                            <button onclick="copyToClipboard('{{ request.build_absolute_uri }}')"
                                    class="w-8 h-8 bg-gray-600 text-white rounded-full flex items-center justify-center hover:bg-gray-700 transition-colors"
                                    title="Copy link">
                                <i class="fas fa-share-alt text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Pages or Call to Action -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <div class="text-center">
                    <h2 class="text-3xl font-bold font-serif text-gray-800 mb-8">Explore More</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <a href="{% url 'about_seminary' %}" 
                           class="block p-6 bg-white rounded-lg shadow hover:shadow-lg transition-shadow hover-lift">
                            <div class="w-12 h-12 bg-gradient-primary text-white rounded-lg flex items-center justify-center mb-4 mx-auto">
                                <i class="fas fa-church"></i>
                            </div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-800">About Seminary</h3>
                            <p class="text-gray-600 text-sm">Learn about our history, mission, and vision</p>
                        </a>
                        
                        <a href="{% url 'faculty_list' %}" 
                           class="block p-6 bg-white rounded-lg shadow hover:shadow-lg transition-shadow hover-lift">
                            <div class="w-12 h-12 bg-gradient-secondary text-white rounded-lg flex items-center justify-center mb-4 mx-auto">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-800">Our Faculty</h3>
                            <p class="text-gray-600 text-sm">Meet our dedicated teachers and mentors</p>
                        </a>
                        
                        <a href="{% url 'publications' %}" 
                           class="block p-6 bg-white rounded-lg shadow hover:shadow-lg transition-shadow hover-lift">
                            <div class="w-12 h-12 bg-gradient-tertiary text-white rounded-lg flex items-center justify-center mb-4 mx-auto">
                                <i class="fas fa-book"></i>
                            </div>
                            <h3 class="text-lg font-semibold mb-2 text-gray-800">Publications</h3>
                            <p class="text-gray-600 text-sm">Explore our academic publications and research</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Show success message
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
        toast.innerHTML = '<i class="fas fa-check mr-2"></i>Link copied to clipboard!';
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        // Fallback for older browsers
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
        toast.innerHTML = '<i class="fas fa-times mr-2"></i>Unable to copy link';
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    });
}

// Smooth scrolling for anchor links within rich content
document.addEventListener('DOMContentLoaded', function() {
    const richContent = document.querySelector('.rich-content');
    if (richContent) {
        const links = richContent.querySelectorAll('a[href^="#"]');
        links.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    }
    
    // Ensure consistent header/footer styling after page load
    setTimeout(() => {
        const topHeader = document.querySelector('.top-header');
        const mainHeader = document.querySelector('.main-header');
        const mainNav = document.querySelector('.main-nav');
        const mainFooter = document.querySelector('.main-footer');
        
        if (topHeader && !topHeader.style.background.includes('gradient')) {
            topHeader.style.cssText = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; color: white !important;';
        }
        
        if (mainHeader && !mainHeader.style.backgroundColor) {
            mainHeader.style.cssText = 'background-color: white !important; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;';
        }
        
        if (mainNav && mainNav.style.backgroundColor !== 'rgb(55, 65, 81)') {
            mainNav.style.cssText = 'background-color: #374151 !important; color: white !important;';
        }
        
        if (mainFooter && mainFooter.style.backgroundColor !== 'rgb(17, 24, 39)') {
            mainFooter.style.cssText = 'background-color: #111827 !important; color: white !important;';
        }
    }, 100);
});
</script>
{% endblock %}